<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
        <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
        <style> #map { height: 600px; } </style>
    </head>
    <body>
        <div id="map"></div>
        <script>

// Basic test of profile routing served up at http://localhost:8080/profile_tester.html
// When you move the markers, sends a JSON request to OTP profile router and prints the resulting JSON in the JS console.

var arlington = new L.LatLng(38.868, -77.14);
var dc = new L.LatLng(38.896, -77.022);
var map = L.map('map');
map.setView(dc, 13);

L.tileLayer('http://otile4.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);

var fromMarker = L.marker(arlington, {draggable: true});
var toMarker = L.marker(dc, {draggable: true});

function profileRoute() {
    var req = new XMLHttpRequest();
    req.overrideMimeType("application/json");
    var url = "http://localhost:8080/otp/routers/dc/profile";
    var fromPos = fromMarker.getLatLng();
    var toPos = toMarker.getLatLng();
    var qstring = '?from=' + fromPos.lat + ',' + fromPos.lng + '&' + 'to=' + toPos.lat + ',' + toPos.lng;
    req.open('GET', url + qstring, true);
    req.onload  = function() {
        var resp = JSON.parse(req.responseText);
        console.log(resp);
    };
    req.send(null);
}

fromMarker.on("dragend",function(ev){
    var pos = ev.target.getLatLng();
    this.bindPopup(pos.toString()).openPopup();
    profileRoute();
});

toMarker.on("dragend",function(ev){
    var pos = ev.target.getLatLng();
    this.bindPopup(pos.toString()).openPopup();
    profileRoute();
});

fromMarker.addTo(map);
toMarker.addTo(map);

        </script>
    </body>
</html>
